# 修复说明

## 问题修复

### 1. Windows 和 Linux 路径不一致问题

**问题描述**：
- 在跨平台环境中，路径分隔符不一致导致路由生成错误
- Windows 使用反斜杠 `\`，Linux/Mac 使用正斜杠 `/`

**修复方案**：
- 添加了 `normalizePath()` 函数统一处理路径格式
- 在所有路径处理函数中使用标准化的路径处理
- 改进了 `generateRoutePath()` 函数的路径处理逻辑
- 优化了文件监听中的路径比较逻辑

**修改文件**：
- `src/utils.ts`: 添加路径标准化函数
- `src/generator.ts`: 改进404路由路径处理
- `src/index.ts`: 优化文件监听路径处理

### 2. guards.ts 文件被覆盖问题

**问题描述**：
- 每次重新生成路由时，用户自定义的 `guards.ts` 文件会被覆盖
- 用户无法保持自己的路由守卫自定义逻辑

**修复方案**：
- 修改生成逻辑，只在 guards 文件不存在时才创建
- 添加 `overwriteGuards` 配置选项，允许用户强制重新生成
- 改进 guards 模板，添加详细的使用说明和示例代码
- 添加友好的控制台提示信息

**修改文件**：
- `src/types.ts`: 添加 `overwriteGuards` 配置选项
- `src/utils.ts`: 更新默认配置
- `src/generator.ts`: 修改文件写入逻辑
- `src/templates/guards.ts`: 改进模板内容和说明

## 新增功能

### 1. 路径标准化工具函数

```typescript
// 跨平台路径标准化
export function normalizePath(filePath: string): string {
  return filePath.replace(/\\/g, "/");
}

// 跨平台路径比较
export function isSamePath(path1: string, path2: string): boolean {
  return path.resolve(path1) === path.resolve(path2);
}
```

### 2. guards 文件保护机制

```typescript
// 新的配置选项
interface OutputConfig {
  routes?: string;
  config?: string;
  guards?: string;
  overwriteGuards?: boolean; // 新增：是否覆盖已存在的守卫文件
}
```

**使用方式**：
```typescript
vueAutoRouter({
  output: {
    guards: "src/router/guards.ts",
    overwriteGuards: false, // 默认为 false，不覆盖已存在的文件
  },
});
```

## 改进的 guards 模板

新的 guards 模板包含：
- 详细的使用说明和注释
- 常见路由守卫场景的示例代码
- 权限检查、登录验证的模板代码
- 更好的类型安全和错误处理

## 使用建议

1. **路径配置**：建议在所有平台上使用正斜杠 `/` 作为路径分隔符
2. **guards 自定义**：首次生成后可以安全地修改 guards 文件，不会被覆盖
3. **强制重新生成**：如需重新生成 guards 文件，设置 `overwriteGuards: true`
4. **跨平台开发**：在不同操作系统间切换开发时，路径处理现在更加稳定

## 兼容性

- ✅ Windows 10/11
- ✅ macOS
- ✅ Linux (Ubuntu, CentOS, etc.)
- ✅ WSL (Windows Subsystem for Linux)

所有修复都向后兼容，不会影响现有项目的使用。